# @draught/sdk

[![npm package][npm-img]][npm-url]
[![Build Status][build-img]][build-url]
[![Downloads][downloads-img]][downloads-url]
[![Issues][issues-img]][issues-url]
[![Code Coverage][codecov-img]][codecov-url]
[![Commitizen Friendly][commitizen-img]][commitizen-url]
[![Semantic Release][semantic-release-img]][semantic-release-url]

> Autogenerated hooks for a Next API. Pairs well with @draught/gateway

## Install

```bash
npm install @draught/sdk
```

## Customization

To customize the codegen, add to your `.draught` file:

```json
// All optional, default values shown
{
  "sdk": {
    "dir": "api",
    "errorTypeImport": "import { ErrorPayload } from 'lib/errors';",
    "output": "lib/sdk.ts"
  }
}
```

## Usage

To generate the hooks:

```bash
npx generate-sdk
```

To use a query hook:

```tsx
function MyApp() {
  // Sends a GET to the endpoint whose API function is named `getBlogPost`
  // Params are used to fill in any dynamic url segments first, then any
  // leftover are sent as query string params, i.e. /posts/123?expanded=true
  let blogPost = useGetBlogPost({ id: '123', expanded: true });
}
```

### SSR & SSG

To leverage server-side rendering and static site generation (i.e. `getServerSideProps` and `getStaticProps`), use the `prefetch` function:

```ts
export const getServerSideProps = prefetch([
  // You can just pass the hook directly:
  useGetBlogPost,

  // Or you can supply params:
  [useGetBlogPost, { id: '123' }],

  // Params can also be a function, which will be given the ctx object:
  [useGetBlogPost, ctx => ({ id: ctx.params.id }),

  // You can also supply a guard function which, if it returns false, will skip
  // prefetching this hook
  [useGetBlogPost, {}, ctx => isLoggedIn(ctx)]
]);
```

You

[build-img]: https://github.com/davewasmer/draught-sdk/actions/workflows/release.yml/badge.svg
[build-url]: https://github.com/davewasmer/draught-sdk/actions/workflows/release.yml
[downloads-img]: https://img.shields.io/npm/dt/@draught/sdk
[downloads-url]: https://www.npmtrends.com/@draught/sdk
[npm-img]: https://img.shields.io/npm/v/@draught/sdk
[npm-url]: https://www.npmjs.com/package/@draught/sdk
[issues-img]: https://img.shields.io/github/issues/davewasmer/draught-sdk
[issues-url]: https://github.com/davewasmer/draught-sdk/issues
[codecov-img]: https://codecov.io/gh/davewasmer/draught-sdk/branch/main/graph/badge.svg
[codecov-url]: https://codecov.io/gh/davewasmer/draught-sdk
[semantic-release-img]: https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg
[semantic-release-url]: https://github.com/semantic-release/semantic-release
[commitizen-img]: https://img.shields.io/badge/commitizen-friendly-brightgreen.svg
[commitizen-url]: http://commitizen.github.io/cz-cli/
